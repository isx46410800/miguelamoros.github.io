<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="Miguel AmorÃ³s">
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>KERBEROS - Miguel's Notes</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "KERBEROS";
    var mkdocs_page_input_path = "kerberos.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Miguel's Notes</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="..">MkDocs</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../linux/">Linux</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../soporte/">Soporte TI</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../vscode/">VSCode</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../gitlab/">Gitlab</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../python/">Python</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../bash_scripting/">BashScripting</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../powershell/">PowerShell/CMD</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../virtuales/">M.Virtuales</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../docker/">Docker</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../kubernetes/">Kubernetes</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../openshift/">Openshift</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../terraform/">Terraform</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../aws/">AWS</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../jenkins/">Jenkins</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../ansible/">Ansible</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../devops/">Devops</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../testing/">Testing</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../tomcat/">Tomcat</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../elastic/">ELKS</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../azure/">Azure</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../office/">Office 365</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../markdown/">Markdown</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../bbdd/">Base de datos</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../sap/">SAP</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../ldap/">LDAP</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../pam/">PAM</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../samba/">SAMBA</a>
                    </li>
                </ul>
                <ul class="current">
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">KERBEROS</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#comandos">COMANDOS</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#kserver">KSERVER</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#khost">KHOST</a>
    </li>
    </ul>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../lvm/">LVM/RAID</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../backup/">Backup</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../routing/">Routing</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../files/">Archivos Destacados</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../windows/">Windows</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../taller/">Taller</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Miguel's Notes</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>KERBEROS</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/isx46410800/miguelamoros.github.io/edit/master/docs/kerberos.md"> Edit on isx46410800/python</a>
      
    </li>
  </ul>
  
  <hr/>
</div>

          <div role="main">
            <div class="section">
              
                <h1 id="kerberos">KERBEROS</h1>
<ul>
<li>
<p>Se conecta el user a keberos y recibe un ticket que demuestra que es quien es.</p>
</li>
<li>
<p>Cuando un user se conecta al server kerbertizado, presenta un ticket y el server lo comprueba sin tener que loguearse todo el rato.</p>
</li>
<li>
<p>Los tickets expiran</p>
</li>
<li>
<p>Demonios: /usr/sbin/krb5kdc y /usr/sbin/kadmind</p>
</li>
<li>
<p>Puertos: 88(keberos), 464(keberos passwd) y 749(keberos admin)</p>
</li>
</ul>
<h2 id="comandos">COMANDOS</h2>
<ul>
<li>
<p>klist</p>
</li>
<li>
<p>/etc/krb5.conf</p>
</li>
<li>
<p>/var/kerberos/krb5kdc/kdc.conf</p>
</li>
<li>
<p>/var/kerberos/krb5kdc/kadm5.acl</p>
</li>
<li>
<p>kadmin.local</p>
</li>
<li>
<p>kadmin.local -q "addprinc -pq kmiguel miguel"</p>
</li>
<li>
<p>kinit user</p>
</li>
<li>
<p>kdestroy</p>
</li>
<li>
<p>kadmin</p>
</li>
<li>
<p>kadmin -p miguel</p>
</li>
<li>
<p>kdb5_util create -s -P masterkey</p>
</li>
</ul>
<h2 id="kserver">KSERVER</h2>
<ul>
<li>Dockerfile:  </li>
</ul>
<pre><code># Version: 0.0.1
# @edt M11 2019-2020
# kerberos
# -------------------------------------
FROM fedora:27
LABEL author=&quot;Miguel Amoros&quot;
LABEL description=&quot;KERBEROS server 2019-2020&quot;
RUN dnf -y install krb5-server passwd procps vim nmap tree
RUN mkdir /opt/docker
COPY * /opt/docker/
RUN chmod +x /opt/docker/install.sh /opt/docker/startup.sh
WORKDIR /opt/docker
CMD [&quot;/opt/docker/startup.sh&quot;]
</code></pre>
<ul>
<li>install.sh:  </li>
</ul>
<pre><code>#! /bin/bash
# @edt ASIX M11 2019-2020
# instal.lacio
# -------------------------------------
cp /opt/docker/krb5.conf /etc/krb5.conf
cp /opt/docker/kdc.conf /var/kerberos/krb5kdc/kdc.conf
cp /opt/docker/kadm5.acl /var/kerberos/krb5kdc/kadm5.acl
#creamos bbdd
kdb5_util create -s -P masterkey
#creamos unos users principales que desde el client podremos coger ticket (pass kpere para pere)
kadmin.local -q &quot;addprinc -pw kpere pere&quot;
kadmin.local -q &quot;addprinc -pw kmarta marta&quot;
kadmin.local -q &quot;addprinc -pw kpau pau&quot;
kadmin.local -q &quot;addprinc -pw kjordi jordi&quot;
kadmin.local -q &quot;addprinc -pw kanna anna&quot;
kadmin.local -q &quot;addprinc -pw kmarta marta/admin&quot;
kadmin.local -q &quot;addprinc -pw kjulia julia&quot;
kadmin.local -q &quot;addprinc -pw kadmin admin&quot;
kadmin.local -q &quot;addprinc -pw kmiguel miguel&quot;
kadmin.local -q &quot;addprinc -pw kuser01 kuser01&quot;
kadmin.local -q &quot;addprinc -pw kuser02 kuser02&quot;
kadmin.local -q &quot;addprinc -pw kuser03 kuser03&quot;
kadmin.local -q &quot;addprinc -pw kuser04 kuser04&quot;
kadmin.local -q &quot;addprinc -pw kuser05 kuser05&quot;
kadmin.local -q &quot;addprinc -pw kuser06 kuser06&quot;
kadmin.local -q &quot;addprinc -randkey host/sshd.edt.org&quot;
</code></pre>
<ul>
<li>Startup.sh:  </li>
</ul>
<pre><code>#! /bin/bash
# @edt ASIX M06 2019-2020
# startup.sh
# -------------------------------------
#instalacio / preparacio
/opt/docker/install.sh &amp;&amp; echo &quot;Install Ok&quot;
# activar els serveis
/usr/sbin/krb5kdc  &amp;&amp; echo &quot;krb5kdc Ok&quot;
/usr/sbin/kadmind -nofork &amp;&amp; echo &quot;kadmind  Ok&quot;
</code></pre>
<ul>
<li>krb5.conf:  </li>
</ul>
<pre><code># To opt out of the system crypto-policies configuration of krb5, remove the
# symlink at /etc/krb5.conf.d/crypto-policies which will not be recreated.
includedir /etc/krb5.conf.d/
[logging]
 default = FILE:/var/log/krb5libs.log
 kdc = FILE:/var/log/krb5kdc.log
 admin_server = FILE:/var/log/kadmind.log
[libdefaults]
 dns_lookup_realm = false
 ticket_lifetime = 24h
 renew_lifetime = 7d
 forwardable = true
 rdns = false
 default_realm = EDT.ORG
# default_ccache_name = KEYRING:persistent:%{uid}
[realms]
 EDT.ORG = {
  kdc = kserver.edt.org
  admin_server = kserver.edt.org
 }
[domain_realm]
 .edt.org = EDT.ORG
 edt.org = EDT.ORG
</code></pre>
<ul>
<li>kdc.conf:  </li>
</ul>
<pre><code>[kdcdefaults]
 kdc_ports = 88
 kdc_tcp_ports = 88
[realms]
 EDT.ORG = {
  #master_key_type = aes256-cts
  acl_file = /var/kerberos/krb5kdc/kadm5.acl
  dict_file = /usr/share/dict/words
  admin_keytab = /var/kerberos/krb5kdc/kadm5.keytab
  supported_enctypes = aes256-cts:normal aes128-cts:normal des3-hmac-sha1:normal arcfour-hmac:normal camellia256-cts:normal camellia128-cts:normal des-hmac-sha1:normal des-cbc-md5:normal des-cbc-crc:normal
 }
</code></pre>
<ul>
<li>kadm5.acl:  </li>
</ul>
<pre><code>*/admin@EDT.ORG *
superuser@EDT.ORG *
pau@EDT.ORG *
</code></pre>
<ul>
<li>/etc/hosts:  </li>
</ul>
<pre><code>127.0.0.1   localhost
::1 localhost ip6-localhost ip6-loopback
fe00::0 ip6-localnet
ff00::0 ip6-mcastprefix
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters
172.18.0.2  kserver.edt.org
</code></pre>
<h2 id="khost">KHOST</h2>
<ul>
<li>Dockerfile:  </li>
</ul>
<pre><code># Version: 0.0.1
# @edt M11 2019-2020
# kerberos
# -------------------------------------
FROM fedora:27
LABEL author=&quot;Miguel Amoros&quot;
LABEL description=&quot;KERBEROS server 2019-2020&quot;
RUN dnf -y install krb5-workstation passwd vim procps nmap tree
RUN mkdir /opt/docker
COPY * /opt/docker/
RUN chmod +x /opt/docker/install.sh /opt/docker/startup.sh
WORKDIR /opt/docker
CMD [&quot;/opt/docker/startup.sh&quot;]
</code></pre>
<ul>
<li>/etc/hosts:  </li>
</ul>
<pre><code>127.0.0.1   localhost
::1 localhost ip6-localhost ip6-loopback
fe00::0 ip6-localnet
ff00::0 ip6-mcastprefix
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters
172.18.0.2  kserver.edt.org
</code></pre>
<ul>
<li>install.sh:  </li>
</ul>
<pre><code>#! /bin/bash
# @edt ASIX M11 2019-2020
# instal.lacio
# -------------------------------------
#fitxer de conf del client
cp /opt/docker/krb5.conf /etc/krb5.conf
</code></pre>
<ul>
<li>startup.sh:  </li>
</ul>
<pre><code>#! /bin/bash
# @edt ASIX M06 2019-2020
# startup.sh
# -------------------------------------
#instalacio / preparacio
/opt/docker/install.sh &amp;&amp; echo &quot;Install Ok&quot;
/bin/bash
</code></pre>
<ul>
<li>krb5.conf:  </li>
</ul>
<pre><code># To opt out of the system crypto-policies configuration of krb5, remove the
# symlink at /etc/krb5.conf.d/crypto-policies which will not be recreated.
includedir /etc/krb5.conf.d/
[logging]
 default = FILE:/var/log/krb5libs.log
 kdc = FILE:/var/log/krb5kdc.log
 admin_server = FILE:/var/log/kadmind.log
[libdefaults]
 dns_lookup_realm = false
 ticket_lifetime = 24h
 renew_lifetime = 7d
 forwardable = true
 rdns = false
 default_realm = EDT.ORG
# default_ccache_name = KEYRING:persistent:%{uid}
[realms]
 EDT.ORG = {
  kdc = kserver.edt.org
  admin_server = kserver.edt.org
 }
[domain_realm]
 .edt.org = EDT.ORG
 edt.org = EDT.ORG
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../lvm/" class="btn btn-neutral float-right" title="LVM/RAID">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../samba/" class="btn btn-neutral" title="SAMBA"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../samba/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../lvm/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
